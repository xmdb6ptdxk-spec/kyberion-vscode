"use strict";var hs=Object.create;var le=Object.defineProperty;var us=Object.getOwnPropertyDescriptor;var fs=Object.getOwnPropertyNames;var ps=Object.getPrototypeOf,gs=Object.prototype.hasOwnProperty;var x=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),ms=(s,e)=>{for(var t in e)le(s,t,{get:e[t],enumerable:!0})},et=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of fs(e))!gs.call(s,r)&&r!==t&&le(s,r,{get:()=>e[r],enumerable:!(n=us(e,r))||n.enumerable});return s};var C=(s,e,t)=>(t=s!=null?hs(ps(s)):{},et(e||!s||!s.__esModule?le(t,"default",{value:s,enumerable:!0}):t,s)),ys=s=>et(le({},"__esModule",{value:!0}),s);var O=x((zn,nt)=>{"use strict";var tt=["nodebuffer","arraybuffer","fragments"],st=typeof Blob<"u";st&&tt.push("blob");nt.exports={BINARY_TYPES:tt,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:st,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var ee=x(($n,ce)=>{"use strict";var{EMPTY_BUFFER:_s}=O(),Pe=Buffer[Symbol.species];function vs(s,e){if(s.length===0)return _s;if(s.length===1)return s[0];let t=Buffer.allocUnsafe(e),n=0;for(let r=0;r<s.length;r++){let i=s[r];t.set(i,n),n+=i.length}return n<e?new Pe(t.buffer,t.byteOffset,n):t}function rt(s,e,t,n,r){for(let i=0;i<r;i++)t[n+i]=s[i]^e[i&3]}function it(s,e){for(let t=0;t<s.length;t++)s[t]^=e[t&3]}function xs(s){return s.length===s.buffer.byteLength?s.buffer:s.buffer.slice(s.byteOffset,s.byteOffset+s.length)}function Me(s){if(Me.readOnly=!0,Buffer.isBuffer(s))return s;let e;return s instanceof ArrayBuffer?e=new Pe(s):ArrayBuffer.isView(s)?e=new Pe(s.buffer,s.byteOffset,s.byteLength):(e=Buffer.from(s),Me.readOnly=!1),e}ce.exports={concat:vs,mask:rt,toArrayBuffer:xs,toBuffer:Me,unmask:it};if(!process.env.WS_NO_BUFFER_UTIL)try{let s=require("bufferutil");ce.exports.mask=function(e,t,n,r,i){i<48?rt(e,t,n,r,i):s.mask(e,t,n,r,i)},ce.exports.unmask=function(e,t){e.length<32?it(e,t):s.unmask(e,t)}}catch{}});var lt=x((Kn,at)=>{"use strict";var ot=Symbol("kDone"),Te=Symbol("kRun"),Oe=class{constructor(e){this[ot]=()=>{this.pending--,this[Te]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Te]()}[Te](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[ot])}}};at.exports=Oe});var se=x((Yn,ut)=>{"use strict";var te=require("zlib"),ct=ee(),bs=lt(),{kStatusCode:dt}=O(),Ss=Buffer[Symbol.species],ws=Buffer.from([0,0,255,255]),he=Symbol("permessage-deflate"),B=Symbol("total-length"),V=Symbol("callback"),L=Symbol("buffers"),G=Symbol("error"),de,Be=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!de){let r=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;de=new bs(r)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[V];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,n=e.find(r=>!(t.serverNoContextTakeover===!1&&r.server_no_context_takeover||r.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>r.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!r.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{let r=t[n];if(r.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(r=r[0],n==="client_max_window_bits"){if(r!==!0){let i=+r;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${r}`);r=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${r}`)}else if(n==="server_max_window_bits"){let i=+r;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${r}`);r=i}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(r!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${r}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=r})}),e}decompress(e,t,n){de.add(r=>{this._decompress(e,t,(i,o)=>{r(),n(i,o)})})}compress(e,t,n){de.add(r=>{this._compress(e,t,(i,o)=>{r(),n(i,o)})})}_decompress(e,t,n){let r=this._isServer?"client":"server";if(!this._inflate){let i=`${r}_max_window_bits`,o=typeof this.params[i]!="number"?te.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=te.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[he]=this,this._inflate[B]=0,this._inflate[L]=[],this._inflate.on("error",ks),this._inflate.on("data",ht)}this._inflate[V]=n,this._inflate.write(e),t&&this._inflate.write(ws),this._inflate.flush(()=>{let i=this._inflate[G];if(i){this._inflate.close(),this._inflate=null,n(i);return}let o=ct.concat(this._inflate[L],this._inflate[B]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[B]=0,this._inflate[L]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),n(null,o)})}_compress(e,t,n){let r=this._isServer?"server":"client";if(!this._deflate){let i=`${r}_max_window_bits`,o=typeof this.params[i]!="number"?te.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=te.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[B]=0,this._deflate[L]=[],this._deflate.on("data",Es)}this._deflate[V]=n,this._deflate.write(e),this._deflate.flush(te.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=ct.concat(this._deflate[L],this._deflate[B]);t&&(i=new Ss(i.buffer,i.byteOffset,i.length-4)),this._deflate[V]=null,this._deflate[B]=0,this._deflate[L]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,i)})}};ut.exports=Be;function Es(s){this[L].push(s),this[B]+=s.length}function ht(s){if(this[B]+=s.length,this[he]._maxPayload<1||this[B]<=this[he]._maxPayload){this[L].push(s);return}this[G]=new RangeError("Max payload size exceeded"),this[G].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[G][dt]=1009,this.removeListener("data",ht),this.reset()}function ks(s){if(this[he]._inflate=null,this[G]){this[V](this[G]);return}s[dt]=1007,this[V](s)}});var z=x((Qn,ue)=>{"use strict";var{isUtf8:ft}=require("buffer"),{hasBlob:Cs}=O(),Ps=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Ms(s){return s>=1e3&&s<=1014&&s!==1004&&s!==1005&&s!==1006||s>=3e3&&s<=4999}function Fe(s){let e=s.length,t=0;for(;t<e;)if((s[t]&128)===0)t++;else if((s[t]&224)===192){if(t+1===e||(s[t+1]&192)!==128||(s[t]&254)===192)return!1;t+=2}else if((s[t]&240)===224){if(t+2>=e||(s[t+1]&192)!==128||(s[t+2]&192)!==128||s[t]===224&&(s[t+1]&224)===128||s[t]===237&&(s[t+1]&224)===160)return!1;t+=3}else if((s[t]&248)===240){if(t+3>=e||(s[t+1]&192)!==128||(s[t+2]&192)!==128||(s[t+3]&192)!==128||s[t]===240&&(s[t+1]&240)===128||s[t]===244&&s[t+1]>143||s[t]>244)return!1;t+=4}else return!1;return!0}function Ts(s){return Cs&&typeof s=="object"&&typeof s.arrayBuffer=="function"&&typeof s.type=="string"&&typeof s.stream=="function"&&(s[Symbol.toStringTag]==="Blob"||s[Symbol.toStringTag]==="File")}ue.exports={isBlob:Ts,isValidStatusCode:Ms,isValidUTF8:Fe,tokenChars:Ps};if(ft)ue.exports.isValidUTF8=function(s){return s.length<24?Fe(s):ft(s)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let s=require("utf-8-validate");ue.exports.isValidUTF8=function(e){return e.length<32?Fe(e):s(e)}}catch{}});var De=x((Zn,xt)=>{"use strict";var{Writable:Os}=require("stream"),pt=se(),{BINARY_TYPES:Bs,EMPTY_BUFFER:gt,kStatusCode:Fs,kWebSocket:Is}=O(),{concat:Ie,toArrayBuffer:Ns,unmask:Ls}=ee(),{isValidStatusCode:Rs,isValidUTF8:mt}=z(),fe=Buffer[Symbol.species],S=0,yt=1,_t=2,vt=3,Ne=4,Le=5,pe=6,Re=class extends Os{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Bs[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Is]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=S}_write(e,t,n){if(this._opcode===8&&this._state==S)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new fe(n.buffer,n.byteOffset+e,n.length-e),new fe(n.buffer,n.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0],r=t.length-e;e>=n.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),r),this._buffers[0]=new fe(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case S:this.getInfo(e);break;case yt:this.getPayloadLength16(e);break;case _t:this.getPayloadLength64(e);break;case vt:this.getMask();break;case Ne:this.getData(e);break;case Le:case pe:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let r=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(r);return}let n=(t[0]&64)===64;if(n&&!this._extensions[pt.extensionName]){let r=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(r);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(n){let r=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(r);return}if(!this._fragmented){let r=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(r);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let r=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(r);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let r=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(r);return}if(n){let r=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(r);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let r=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(r);return}}else{let r=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(r);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let r=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(r);return}}else if(this._masked){let r=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(r);return}this._payloadLength===126?this._state=yt:this._payloadLength===127?this._state=_t:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);if(n>Math.pow(2,21)-1){let r=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(r);return}this._payloadLength=n*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=vt:this._state=Ne}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Ne}getData(e){let t=gt;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Ls(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=Le,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[pt.extensionName].decompress(e,this._fin,(r,i)=>{if(r)return t(r);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(o);return}this._fragments.push(i)}this.dataMessage(t),this._state===S&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=S;return}let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let r;this._binaryType==="nodebuffer"?r=Ie(n,t):this._binaryType==="arraybuffer"?r=Ns(Ie(n,t)):this._binaryType==="blob"?r=new Blob(n):r=n,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=S):(this._state=pe,setImmediate(()=>{this.emit("message",r,!0),this._state=S,this.startLoop(e)}))}else{let r=Ie(n,t);if(!this._skipUTF8Validation&&!mt(r)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===Le||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=S):(this._state=pe,setImmediate(()=>{this.emit("message",r,!1),this._state=S,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,gt),this.end();else{let n=e.readUInt16BE(0);if(!Rs(n)){let i=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(i);return}let r=new fe(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!mt(r)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._loop=!1,this.emit("conclude",n,r),this.end()}this._state=S;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=S):(this._state=pe,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=S,this.startLoop(t)}))}createError(e,t,n,r,i){this._loop=!1,this._errored=!0;let o=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[Fs]=r,o}};xt.exports=Re});var We=x((Jn,wt)=>{"use strict";var{Duplex:Xn}=require("stream"),{randomFillSync:Ds}=require("crypto"),bt=se(),{EMPTY_BUFFER:As,kWebSocket:Us,NOOP:Ws}=O(),{isBlob:$,isValidStatusCode:qs}=z(),{mask:St,toBuffer:D}=ee(),w=Symbol("kByteLength"),Hs=Buffer.alloc(4),ge=8*1024,A,K=ge,E=0,js=1,Vs=2,Ae=class s{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=E,this.onerror=Ws,this[Us]=void 0}static frame(e,t){let n,r=!1,i=2,o=!1;t.mask&&(n=t.maskBuffer||Hs,t.generateMask?t.generateMask(n):(K===ge&&(A===void 0&&(A=Buffer.alloc(ge)),Ds(A,0,ge),K=0),n[0]=A[K++],n[1]=A[K++],n[2]=A[K++],n[3]=A[K++]),o=(n[0]|n[1]|n[2]|n[3])===0,i=6);let a;typeof e=="string"?(!t.mask||o)&&t[w]!==void 0?a=t[w]:(e=Buffer.from(e),a=e.length):(a=e.length,r=t.mask&&t.readOnly&&!o);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let l=Buffer.allocUnsafe(r?a+i:i);return l[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(l[0]|=64),l[1]=c,c===126?l.writeUInt16BE(a,2):c===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),t.mask?(l[1]|=128,l[i-4]=n[0],l[i-3]=n[1],l[i-2]=n[2],l[i-1]=n[3],o?[l,e]:r?(St(e,n,l,i,a),[l]):(St(e,n,e,0,a),[l,e])):[l,e]}close(e,t,n,r){let i;if(e===void 0)i=As;else{if(typeof e!="number"||!qs(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}let o={[w]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==E?this.enqueue([this.dispatch,i,!1,o,r]):this.sendFrame(s.frame(i,o),r)}ping(e,t,n){let r,i;if(typeof e=="string"?(r=Buffer.byteLength(e),i=!1):$(e)?(r=e.size,i=!1):(e=D(e),r=e.length,i=D.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[w]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};$(e)?this._state!==E?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):this._state!==E?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(s.frame(e,o),n)}pong(e,t,n){let r,i;if(typeof e=="string"?(r=Buffer.byteLength(e),i=!1):$(e)?(r=e.size,i=!1):(e=D(e),r=e.length,i=D.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[w]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};$(e)?this._state!==E?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):this._state!==E?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(s.frame(e,o),n)}send(e,t,n){let r=this._extensions[bt.extensionName],i=t.binary?2:1,o=t.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):$(e)?(a=e.size,c=!1):(e=D(e),a=e.length,c=D.readOnly),this._firstFragment?(this._firstFragment=!1,o&&r&&r.params[r._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=r._threshold),this._compress=o):(o=!1,i=0),t.fin&&(this._firstFragment=!0);let l={[w]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:o};$(e)?this._state!==E?this.enqueue([this.getBlobData,e,this._compress,l,n]):this.getBlobData(e,this._compress,l,n):this._state!==E?this.enqueue([this.dispatch,e,this._compress,l,n]):this.dispatch(e,this._compress,l,n)}getBlobData(e,t,n,r){this._bufferedBytes+=n[w],this._state=Vs,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(Ue,this,a,r);return}this._bufferedBytes-=n[w];let o=D(i);t?this.dispatch(o,t,n,r):(this._state=E,this.sendFrame(s.frame(o,n),r),this.dequeue())}).catch(i=>{process.nextTick(Gs,this,i,r)})}dispatch(e,t,n,r){if(!t){this.sendFrame(s.frame(e,n),r);return}let i=this._extensions[bt.extensionName];this._bufferedBytes+=n[w],this._state=js,i.compress(e,n.fin,(o,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");Ue(this,c,r);return}this._bufferedBytes-=n[w],this._state=E,n.readOnly=!1,this.sendFrame(s.frame(a,n),r),this.dequeue()})}dequeue(){for(;this._state===E&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][w],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][w],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};wt.exports=Ae;function Ue(s,e,t){typeof t=="function"&&t(e);for(let n=0;n<s._queue.length;n++){let r=s._queue[n],i=r[r.length-1];typeof i=="function"&&i(e)}}function Gs(s,e,t){Ue(s,e,t),s.onerror(e)}});var Ft=x((er,Bt)=>{"use strict";var{kForOnEventAttribute:ne,kListener:qe}=O(),Et=Symbol("kCode"),kt=Symbol("kData"),Ct=Symbol("kError"),Pt=Symbol("kMessage"),Mt=Symbol("kReason"),Y=Symbol("kTarget"),Tt=Symbol("kType"),Ot=Symbol("kWasClean"),F=class{constructor(e){this[Y]=null,this[Tt]=e}get target(){return this[Y]}get type(){return this[Tt]}};Object.defineProperty(F.prototype,"target",{enumerable:!0});Object.defineProperty(F.prototype,"type",{enumerable:!0});var U=class extends F{constructor(e,t={}){super(e),this[Et]=t.code===void 0?0:t.code,this[Mt]=t.reason===void 0?"":t.reason,this[Ot]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Et]}get reason(){return this[Mt]}get wasClean(){return this[Ot]}};Object.defineProperty(U.prototype,"code",{enumerable:!0});Object.defineProperty(U.prototype,"reason",{enumerable:!0});Object.defineProperty(U.prototype,"wasClean",{enumerable:!0});var Q=class extends F{constructor(e,t={}){super(e),this[Ct]=t.error===void 0?null:t.error,this[Pt]=t.message===void 0?"":t.message}get error(){return this[Ct]}get message(){return this[Pt]}};Object.defineProperty(Q.prototype,"error",{enumerable:!0});Object.defineProperty(Q.prototype,"message",{enumerable:!0});var re=class extends F{constructor(e,t={}){super(e),this[kt]=t.data===void 0?null:t.data}get data(){return this[kt]}};Object.defineProperty(re.prototype,"data",{enumerable:!0});var zs={addEventListener(s,e,t={}){for(let r of this.listeners(s))if(!t[ne]&&r[qe]===e&&!r[ne])return;let n;if(s==="message")n=function(i,o){let a=new re("message",{data:o?i:i.toString()});a[Y]=this,me(e,this,a)};else if(s==="close")n=function(i,o){let a=new U("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Y]=this,me(e,this,a)};else if(s==="error")n=function(i){let o=new Q("error",{error:i,message:i.message});o[Y]=this,me(e,this,o)};else if(s==="open")n=function(){let i=new F("open");i[Y]=this,me(e,this,i)};else return;n[ne]=!!t[ne],n[qe]=e,t.once?this.once(s,n):this.on(s,n)},removeEventListener(s,e){for(let t of this.listeners(s))if(t[qe]===e&&!t[ne]){this.removeListener(s,t);break}}};Bt.exports={CloseEvent:U,ErrorEvent:Q,Event:F,EventTarget:zs,MessageEvent:re};function me(s,e,t){typeof s=="object"&&s.handleEvent?s.handleEvent.call(s,t):s.call(e,t)}});var He=x((tr,It)=>{"use strict";var{tokenChars:ie}=z();function P(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}function $s(s){let e=Object.create(null),t=Object.create(null),n=!1,r=!1,i=!1,o,a,c=-1,l=-1,d=-1,h=0;for(;h<s.length;h++)if(l=s.charCodeAt(h),o===void 0)if(d===-1&&ie[l]===1)c===-1&&(c=h);else if(h!==0&&(l===32||l===9))d===-1&&c!==-1&&(d=h);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${h}`);d===-1&&(d=h);let y=s.slice(c,d);l===44?(P(e,y,t),t=Object.create(null)):o=y,c=d=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);else if(a===void 0)if(d===-1&&ie[l]===1)c===-1&&(c=h);else if(l===32||l===9)d===-1&&c!==-1&&(d=h);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${h}`);d===-1&&(d=h),P(t,s.slice(c,d),!0),l===44&&(P(e,o,t),t=Object.create(null),o=void 0),c=d=-1}else if(l===61&&c!==-1&&d===-1)a=s.slice(c,h),c=d=-1;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(r){if(ie[l]!==1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1?c=h:n||(n=!0),r=!1}else if(i)if(ie[l]===1)c===-1&&(c=h);else if(l===34&&c!==-1)i=!1,d=h;else if(l===92)r=!0;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(l===34&&s.charCodeAt(h-1)===61)i=!0;else if(d===-1&&ie[l]===1)c===-1&&(c=h);else if(c!==-1&&(l===32||l===9))d===-1&&(d=h);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${h}`);d===-1&&(d=h);let y=s.slice(c,d);n&&(y=y.replace(/\\/g,""),n=!1),P(t,a,y),l===44&&(P(e,o,t),t=Object.create(null),o=void 0),a=void 0,c=d=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);if(c===-1||i||l===32||l===9)throw new SyntaxError("Unexpected end of input");d===-1&&(d=h);let g=s.slice(c,d);return o===void 0?P(e,g,t):(a===void 0?P(t,g,!0):n?P(t,a,g.replace(/\\/g,"")):P(t,a,g),P(e,o,t)),e}function Ks(s){return Object.keys(s).map(e=>{let t=s[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(r=>{let i=n[r];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?r:`${r}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}It.exports={format:Ks,parse:$s}});var xe=x((rr,Gt)=>{"use strict";var Ys=require("events"),Qs=require("https"),Zs=require("http"),Rt=require("net"),Xs=require("tls"),{randomBytes:Js,createHash:en}=require("crypto"),{Duplex:sr,Readable:nr}=require("stream"),{URL:je}=require("url"),R=se(),tn=De(),sn=We(),{isBlob:nn}=z(),{BINARY_TYPES:Nt,EMPTY_BUFFER:ye,GUID:rn,kForOnEventAttribute:Ve,kListener:on,kStatusCode:an,kWebSocket:_,NOOP:Dt}=O(),{EventTarget:{addEventListener:ln,removeEventListener:cn}}=Ft(),{format:dn,parse:hn}=He(),{toBuffer:un}=ee(),fn=30*1e3,At=Symbol("kAborted"),Ge=[8,13],I=["CONNECTING","OPEN","CLOSING","CLOSED"],pn=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,p=class s extends Ys{constructor(e,t,n){super(),this._binaryType=Nt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=ye,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=s.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(n=t,t=[]):t=[t]),Ut(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Nt.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){let r=new tn({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new sn(e,this._extensions,n.generateMask);this._receiver=r,this._sender=i,this._socket=e,r[_]=this,i[_]=this,e[_]=this,r.on("conclude",yn),r.on("drain",_n),r.on("error",vn),r.on("message",xn),r.on("ping",bn),r.on("pong",Sn),i.onerror=wn,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Ht),e.on("data",ve),e.on("end",jt),e.on("error",Vt),this._readyState=s.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=s.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[R.extensionName]&&this._extensions[R.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=s.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==s.CLOSED){if(this.readyState===s.CONNECTING){b(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===s.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=s.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),qt(this)}}pause(){this.readyState===s.CONNECTING||this.readyState===s.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===s.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==s.OPEN){ze(this,e,n);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||ye,t,n)}pong(e,t,n){if(this.readyState===s.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==s.OPEN){ze(this,e,n);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||ye,t,n)}resume(){this.readyState===s.CONNECTING||this.readyState===s.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===s.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(n=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==s.OPEN){ze(this,e,n);return}let r={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[R.extensionName]||(r.compress=!1),this._sender.send(e||ye,r,n)}terminate(){if(this.readyState!==s.CLOSED){if(this.readyState===s.CONNECTING){b(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=s.CLOSING,this._socket.destroy())}}};Object.defineProperty(p,"CONNECTING",{enumerable:!0,value:I.indexOf("CONNECTING")});Object.defineProperty(p.prototype,"CONNECTING",{enumerable:!0,value:I.indexOf("CONNECTING")});Object.defineProperty(p,"OPEN",{enumerable:!0,value:I.indexOf("OPEN")});Object.defineProperty(p.prototype,"OPEN",{enumerable:!0,value:I.indexOf("OPEN")});Object.defineProperty(p,"CLOSING",{enumerable:!0,value:I.indexOf("CLOSING")});Object.defineProperty(p.prototype,"CLOSING",{enumerable:!0,value:I.indexOf("CLOSING")});Object.defineProperty(p,"CLOSED",{enumerable:!0,value:I.indexOf("CLOSED")});Object.defineProperty(p.prototype,"CLOSED",{enumerable:!0,value:I.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(s=>{Object.defineProperty(p.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(p.prototype,`on${s}`,{enumerable:!0,get(){for(let e of this.listeners(s))if(e[Ve])return e[on];return null},set(e){for(let t of this.listeners(s))if(t[Ve]){this.removeListener(s,t);break}typeof e=="function"&&this.addEventListener(s,e,{[Ve]:!0})}})});p.prototype.addEventListener=ln;p.prototype.removeEventListener=cn;Gt.exports=p;function Ut(s,e,t,n){let r={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Ge[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(s._autoPong=r.autoPong,!Ge.includes(r.protocolVersion))throw new RangeError(`Unsupported protocol version: ${r.protocolVersion} (supported versions: ${Ge.join(", ")})`);let i;if(e instanceof je)i=e;else try{i=new je(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),s._url=i.href;let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!o&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let u=new SyntaxError(c);if(s._redirects===0)throw u;_e(s,u);return}let l=o?443:80,d=Js(16).toString("base64"),h=o?Qs.request:Zs.request,g=new Set,y;if(r.createConnection=r.createConnection||(o?mn:gn),r.defaultPort=r.defaultPort||l,r.port=i.port||l,r.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,r.headers={...r.headers,"Sec-WebSocket-Version":r.protocolVersion,"Sec-WebSocket-Key":d,Connection:"Upgrade",Upgrade:"websocket"},r.path=i.pathname+i.search,r.timeout=r.handshakeTimeout,r.perMessageDeflate&&(y=new R(r.perMessageDeflate!==!0?r.perMessageDeflate:{},!1,r.maxPayload),r.headers["Sec-WebSocket-Extensions"]=dn({[R.extensionName]:y.offer()})),t.length){for(let u of t){if(typeof u!="string"||!pn.test(u)||g.has(u))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(u)}r.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(r.origin&&(r.protocolVersion<13?r.headers["Sec-WebSocket-Origin"]=r.origin:r.headers.Origin=r.origin),(i.username||i.password)&&(r.auth=`${i.username}:${i.password}`),a){let u=r.path.split(":");r.socketPath=u[0],r.path=u[1]}let m;if(r.followRedirects){if(s._redirects===0){s._originalIpc=a,s._originalSecure=o,s._originalHostOrSocketPath=a?r.socketPath:i.host;let u=n&&n.headers;if(n={...n,headers:{}},u)for(let[v,H]of Object.entries(u))n.headers[v.toLowerCase()]=H}else if(s.listenerCount("redirect")===0){let u=a?s._originalIpc?r.socketPath===s._originalHostOrSocketPath:!1:s._originalIpc?!1:i.host===s._originalHostOrSocketPath;(!u||s._originalSecure&&!o)&&(delete r.headers.authorization,delete r.headers.cookie,u||delete r.headers.host,r.auth=void 0)}r.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(r.auth).toString("base64")),m=s._req=h(r),s._redirects&&s.emit("redirect",s.url,m)}else m=s._req=h(r);r.timeout&&m.on("timeout",()=>{b(s,m,"Opening handshake has timed out")}),m.on("error",u=>{m===null||m[At]||(m=s._req=null,_e(s,u))}),m.on("response",u=>{let v=u.headers.location,H=u.statusCode;if(v&&r.followRedirects&&H>=300&&H<400){if(++s._redirects>r.maxRedirects){b(s,m,"Maximum redirects exceeded");return}m.abort();let X;try{X=new je(v,e)}catch{let j=new SyntaxError(`Invalid URL: ${v}`);_e(s,j);return}Ut(s,X,t,n)}else s.emit("unexpected-response",m,u)||b(s,m,`Unexpected server response: ${u.statusCode}`)}),m.on("upgrade",(u,v,H)=>{if(s.emit("upgrade",u),s.readyState!==p.CONNECTING)return;m=s._req=null;let X=u.headers.upgrade;if(X===void 0||X.toLowerCase()!=="websocket"){b(s,v,"Invalid Upgrade header");return}let Ze=en("sha1").update(d+rn).digest("base64");if(u.headers["sec-websocket-accept"]!==Ze){b(s,v,"Invalid Sec-WebSocket-Accept header");return}let j=u.headers["sec-websocket-protocol"],J;if(j!==void 0?g.size?g.has(j)||(J="Server sent an invalid subprotocol"):J="Server sent a subprotocol but none was requested":g.size&&(J="Server sent no subprotocol"),J){b(s,v,J);return}j&&(s._protocol=j);let Xe=u.headers["sec-websocket-extensions"];if(Xe!==void 0){if(!y){b(s,v,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let ke;try{ke=hn(Xe)}catch{b(s,v,"Invalid Sec-WebSocket-Extensions header");return}let Je=Object.keys(ke);if(Je.length!==1||Je[0]!==R.extensionName){b(s,v,"Server indicated an extension that was not requested");return}try{y.accept(ke[R.extensionName])}catch{b(s,v,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[R.extensionName]=y}s.setSocket(v,H,{allowSynchronousEvents:r.allowSynchronousEvents,generateMask:r.generateMask,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation})}),r.finishRequest?r.finishRequest(m,s):m.end()}function _e(s,e){s._readyState=p.CLOSING,s._errorEmitted=!0,s.emit("error",e),s.emitClose()}function gn(s){return s.path=s.socketPath,Rt.connect(s)}function mn(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=Rt.isIP(s.host)?"":s.host),Xs.connect(s)}function b(s,e,t){s._readyState=p.CLOSING;let n=new Error(t);Error.captureStackTrace(n,b),e.setHeader?(e[At]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(_e,s,n)):(e.destroy(n),e.once("error",s.emit.bind(s,"error")),e.once("close",s.emitClose.bind(s)))}function ze(s,e,t){if(e){let n=nn(e)?e.size:un(e).length;s._socket?s._sender._bufferedBytes+=n:s._bufferedAmount+=n}if(t){let n=new Error(`WebSocket is not open: readyState ${s.readyState} (${I[s.readyState]})`);process.nextTick(t,n)}}function yn(s,e){let t=this[_];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=s,t._socket[_]!==void 0&&(t._socket.removeListener("data",ve),process.nextTick(Wt,t._socket),s===1005?t.close():t.close(s,e))}function _n(){let s=this[_];s.isPaused||s._socket.resume()}function vn(s){let e=this[_];e._socket[_]!==void 0&&(e._socket.removeListener("data",ve),process.nextTick(Wt,e._socket),e.close(s[an])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",s))}function Lt(){this[_].emitClose()}function xn(s,e){this[_].emit("message",s,e)}function bn(s){let e=this[_];e._autoPong&&e.pong(s,!this._isServer,Dt),e.emit("ping",s)}function Sn(s){this[_].emit("pong",s)}function Wt(s){s.resume()}function wn(s){let e=this[_];e.readyState!==p.CLOSED&&(e.readyState===p.OPEN&&(e._readyState=p.CLOSING,qt(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",s)))}function qt(s){s._closeTimer=setTimeout(s._socket.destroy.bind(s._socket),fn)}function Ht(){let s=this[_];this.removeListener("close",Ht),this.removeListener("data",ve),this.removeListener("end",jt),s._readyState=p.CLOSING;let e;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(e=s._socket.read())!==null&&s._receiver.write(e),s._receiver.end(),this[_]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",Lt),s._receiver.on("finish",Lt))}function ve(s){this[_]._receiver.write(s)||this.pause()}function jt(){let s=this[_];s._readyState=p.CLOSING,s._receiver.end(),this.end()}function Vt(){let s=this[_];this.removeListener("error",Vt),this.on("error",Dt),s&&(s._readyState=p.CLOSING,this.destroy())}});var Yt=x((or,Kt)=>{"use strict";var ir=xe(),{Duplex:En}=require("stream");function zt(s){s.emit("close")}function kn(){!this.destroyed&&this._writableState.finished&&this.destroy()}function $t(s){this.removeListener("error",$t),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function Cn(s,e){let t=!0,n=new En({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(i,o){let a=!o&&n._readableState.objectMode?i.toString():i;n.push(a)||s.pause()}),s.once("error",function(i){n.destroyed||(t=!1,n.destroy(i))}),s.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(r,i){if(s.readyState===s.CLOSED){i(r),process.nextTick(zt,n);return}let o=!1;s.once("error",function(c){o=!0,i(c)}),s.once("close",function(){o||i(r),process.nextTick(zt,n)}),t&&s.terminate()},n._final=function(r){if(s.readyState===s.CONNECTING){s.once("open",function(){n._final(r)});return}s._socket!==null&&(s._socket._writableState.finished?(r(),n._readableState.endEmitted&&n.destroy()):(s._socket.once("finish",function(){r()}),s.close()))},n._read=function(){s.isPaused&&s.resume()},n._write=function(r,i,o){if(s.readyState===s.CONNECTING){s.once("open",function(){n._write(r,i,o)});return}s.send(r,o)},n.on("end",kn),n.on("error",$t),n}Kt.exports=Cn});var Zt=x((ar,Qt)=>{"use strict";var{tokenChars:Pn}=z();function Mn(s){let e=new Set,t=-1,n=-1,r=0;for(r;r<s.length;r++){let o=s.charCodeAt(r);if(n===-1&&Pn[o]===1)t===-1&&(t=r);else if(r!==0&&(o===32||o===9))n===-1&&t!==-1&&(n=r);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${r}`);n===-1&&(n=r);let a=s.slice(t,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=n=-1}else throw new SyntaxError(`Unexpected character at index ${r}`)}if(t===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let i=s.slice(t,r);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Qt.exports={parse:Mn}});var rs=x((cr,ns)=>{"use strict";var Tn=require("events"),be=require("http"),{Duplex:lr}=require("stream"),{createHash:On}=require("crypto"),Xt=He(),W=se(),Bn=Zt(),Fn=xe(),{GUID:In,kWebSocket:Nn}=O(),Ln=/^[+/0-9A-Za-z]{22}==$/,Jt=0,es=1,ss=2,$e=class extends Tn{constructor(e,t){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Fn,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=be.createServer((n,r)=>{let i=be.STATUS_CODES[426];r.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),r.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=Rn(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(r,i,o)=>{this.handleUpgrade(r,i,o,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Jt}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===ss){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(oe,this);return}if(e&&this.once("close",e),this._state!==es)if(this._state=es,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(oe,this):process.nextTick(oe,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{oe(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",ts);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){q(this,e,t,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){q(this,e,t,400,"Invalid Upgrade header");return}if(i===void 0||!Ln.test(i)){q(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){q(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){ae(t,400);return}let c=e.headers["sec-websocket-protocol"],l=new Set;if(c!==void 0)try{l=Bn.parse(c)}catch{q(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let d=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&d!==void 0){let g=new W(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let y=Xt.parse(d);y[W.extensionName]&&(g.accept(y[W.extensionName]),h[W.extensionName]=g)}catch{q(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(y,m,u,v)=>{if(!y)return ae(t,m||401,u,v);this.completeUpgrade(h,i,l,e,t,n,r)});return}if(!this.options.verifyClient(g))return ae(t,401)}this.completeUpgrade(h,i,l,e,t,n,r)}completeUpgrade(e,t,n,r,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[Nn])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Jt)return ae(i,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${On("sha1").update(t+In).digest("base64")}`],d=new this.options.WebSocket(null,void 0,this.options);if(n.size){let h=this.options.handleProtocols?this.options.handleProtocols(n,r):n.values().next().value;h&&(l.push(`Sec-WebSocket-Protocol: ${h}`),d._protocol=h)}if(e[W.extensionName]){let h=e[W.extensionName].params,g=Xt.format({[W.extensionName]:[h]});l.push(`Sec-WebSocket-Extensions: ${g}`),d._extensions=e}this.emit("headers",l,r),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",ts),d.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(d),d.on("close",()=>{this.clients.delete(d),this._shouldEmitClose&&!this.clients.size&&process.nextTick(oe,this)})),a(d,r)}};ns.exports=$e;function Rn(s,e){for(let t of Object.keys(e))s.on(t,e[t]);return function(){for(let n of Object.keys(e))s.removeListener(n,e[n])}}function oe(s){s._state=ss,s.emit("close")}function ts(){this.destroy()}function ae(s,e,t,n){t=t||be.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...n},s.once("finish",s.destroy),s.end(`HTTP/1.1 ${e} ${be.STATUS_CODES[e]}\r
`+Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`\r
`)+`\r
\r
`+t)}function q(s,e,t,n,r,i){if(s.listenerCount("wsClientError")){let o=new Error(r);Error.captureStackTrace(o,q),s.emit("wsClientError",o,t,e)}else ae(t,n,r,i)}});var Vn={};ms(Vn,{activate:()=>qn,deactivate:()=>jn});module.exports=ys(Vn);var f=C(require("vscode"));var Dn=C(Yt(),1),An=C(De(),1),Un=C(We(),1),is=C(xe(),1),Wn=C(rs(),1);var Se=is.default;var Ye=class{constructor(e="ws://localhost:8000/ws/nexus"){this.ws=null;this.connected=!1;this.reconnectAttempts=0;this.maxReconnectAttempts=10;this.reconnectDelay=2e3;this.messageHandlers=[];this.connectionHandlers=[];this.pendingRequests=new Map;this.messageQueue=[];this.heartbeatInterval=null;this.heartbeatTimeout=3e4;this.wsUrl=e}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=setInterval(()=>{this.connected&&this.ws&&this.sendRaw({type:"heartbeat",timestamp:new Date().toISOString()})},this.heartbeatTimeout)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}onMessage(e){this.messageHandlers.push(e)}onConnectionChange(e){this.connectionHandlers.push(e)}notifyConnectionChange(e){this.connected=e;for(let t of this.connectionHandlers)t(e)}notifyMessage(e){for(let t of this.messageHandlers)t(e)}async connect(){return new Promise(e=>{try{this.ws=new Se(this.wsUrl),this.ws.on("open",()=>{console.log("\u{1F50C} Forge Synapse verbunden"),this.connected=!0,this.reconnectAttempts=0,this.notifyConnectionChange(!0),this.startHeartbeat(),this.flushMessageQueue(),e(!0)}),this.ws.on("close",()=>{console.log("\u{1F50C} Forge Synapse getrennt"),this.connected=!1,this.stopHeartbeat(),this.notifyConnectionChange(!1),this.attemptReconnect()}),this.ws.on("error",t=>{console.error("\u{1F50C} Forge Synapse Fehler:",t),this.connected=!1,this.stopHeartbeat(),this.notifyConnectionChange(!1),e(!1)}),this.ws.on("message",t=>{try{let n=JSON.parse(t.toString());this.handleMessage(n)}catch(n){console.error("Fehler beim Parsen der Nachricht:",n)}})}catch(t){console.error("Verbindungsfehler:",t),e(!1)}})}handleMessage(e){if(e.type!=="heartbeat_ack"){if(e.type==="final_answer"||e.type==="response"||e.type==="chat_response"||e.type==="plan_response")for(let[t,n]of this.pendingRequests.entries()){this.pendingRequests.delete(t),n(e);return}if(e.data){let t=e.data?.request_id;if(t&&this.pendingRequests.has(t)){let n=this.pendingRequests.get(t);this.pendingRequests.delete(t),n(e);return}}this.notifyMessage(e)}}flushMessageQueue(){for(;this.messageQueue.length>0;){let e=this.messageQueue.shift();this.sendRaw(e)}}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("\u{1F50C} Max Reconnect-Versuche erreicht");return}this.reconnectAttempts++,console.log(`\u{1F50C} Reconnect Versuch ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),setTimeout(()=>{this.connect()},this.reconnectDelay*this.reconnectAttempts)}disconnect(){this.stopHeartbeat(),this.ws&&(this.ws.close(),this.ws=null),this.connected=!1,this.notifyConnectionChange(!1)}isConnected(){return this.connected&&this.ws?.readyState===Se.OPEN}sendRaw(e){if(!this.ws||this.ws.readyState!==Se.OPEN)return this.messageQueue.push(e),!1;try{return this.ws.send(JSON.stringify(e)),!0}catch(t){return console.error("Fehler beim Senden:",t),this.messageQueue.push(e),!1}}async sendAndWait(e,t=6e4){return new Promise((n,r)=>{let i=this.generateRequestId(),o={...e,request_id:i},a=setTimeout(()=>{this.pendingRequests.delete(i),r(new Error("Timeout beim Warten auf Antwort"))},t);this.pendingRequests.set(i,c=>{clearTimeout(a),n(c)}),this.sendRaw(o)||this.connect().then(c=>{c||(clearTimeout(a),this.pendingRequests.delete(i),r(new Error("Keine Verbindung zur Forge")))})})}generateRequestId(){return"req_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async chat(e,t=[],n=[]){let r={type:"chat_message",content:e,data:{history:t,attachments:n},timestamp:new Date().toISOString()};return this.sendAndWait(r)}async createPlan(e,t){let n={type:"create_plan",content:e,data:{context:t},timestamp:new Date().toISOString()};return this.sendAndWait(n,12e4)}async executeStep(e,t){let n={type:"execute_step",data:{plan_id:e,step_id:t},timestamp:new Date().toISOString()};return this.sendAndWait(n,18e4)}async readFile(e){let t={type:"read_file",file_path:e,timestamp:new Date().toISOString()};return this.sendAndWait(t)}async writeFile(e,t){let n={type:"write_file",file_path:e,content:t,timestamp:new Date().toISOString()};return this.sendAndWait(n)}async analyzeFile(e){let t={type:"analyze_file",file_path:e,timestamp:new Date().toISOString()};return this.sendAndWait(t)}async executeCode(e,t="python"){let n={type:"execute_code",code:e,data:{language:t},timestamp:new Date().toISOString()};return this.sendAndWait(n)}async createProject(e,t,n){let r={type:"create_project",project:e,data:{description:t,requirements:n},timestamp:new Date().toISOString()};return this.sendAndWait(r,3e5)}async getStatus(){let e={type:"status",timestamp:new Date().toISOString()};return this.sendAndWait(e,5e3)}async getMasters(){let e={type:"get_masters",timestamp:new Date().toISOString()};return this.sendAndWait(e,5e3)}},Ke=null;function os(s){return Ke||(Ke=new Ye(s)),Ke}var as=C(require("vscode")),we=class{constructor(e,t,n){this.extensionUri=e;this.forgeClient=t;this.fileHandler=n;this.messageHistory=[];this.isConnected=!1;this.isPlanMode=!1;this.currentPlan=null;this.isExecuting=!1;this.attachedFiles=[]}static{this.viewType="kyberion.chatView"}resolveWebviewView(e,t,n){this.view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this.extensionUri]},e.webview.html=this.getHtmlForWebview(e.webview),setTimeout(()=>{let r=this.forgeClient.isConnected();this.isConnected=r,this.postMessage({type:"connectionStatus",connected:r})},100),e.webview.onDidReceiveMessage(async r=>{switch(r.type){case"sendMessage":await this.handleSendMessage(r.message);break;case"connect":await this.handleConnect();break;case"disconnect":this.handleDisconnect();break;case"toggleMode":this.togglePlanMode();break;case"createPlan":await this.handleCreatePlan(r.message);break;case"startExecution":await this.startPlanExecution();break;case"pauseExecution":this.pausePlanExecution();break;case"resumeExecution":await this.resumePlanExecution();break;case"attachFile":await this.handleAttachFile();break;case"removeAttachment":this.removeAttachment(r.index);break;case"clearChat":this.clearChat();break}})}updateConnectionStatus(e){this.isConnected=e,this.postMessage({type:"connectionStatus",connected:e})}togglePlanMode(){this.isPlanMode=!this.isPlanMode,this.postMessage({type:"modeChanged",isPlanMode:this.isPlanMode})}handleForgeMessage(e){e.type==="thought"?this.postMessage({type:"thought",content:e.content,agent:e.agent}):e.type==="agent_activity"&&this.postMessage({type:"agentActivity",agent:e.agent,action:e.content})}analyzeFile(e,t){let n=e.split("/").pop()||e;this.attachedFiles.push({name:n,content:t}),this.postMessage({type:"fileAttached",files:this.attachedFiles.map(i=>i.name)});let r="Bitte analysiere diese Datei: "+n;this.handleSendMessage(r)}async handleSendMessage(e){if(!this.isConnected){this.postMessage({type:"error",message:"Nicht verbunden. Bitte zuerst verbinden."});return}let t=e;if(this.attachedFiles.length>0){t+=`

--- Angeh\xE4ngte Dateien ---
`;for(let n of this.attachedFiles)t+=`
### `+n.name+":\n```\n"+n.content+"\n```\n";this.attachedFiles=[],this.postMessage({type:"fileAttached",files:[]})}this.postMessage({type:"userMessage",message:e}),this.messageHistory.push({role:"user",content:e}),this.postMessage({type:"thinking",isThinking:!0});try{let n=await this.forgeClient.chat(t,this.messageHistory);if(this.postMessage({type:"thinking",isThinking:!1}),n){let r=n.content||"";this.messageHistory.push({role:"assistant",content:r}),this.postMessage({type:"assistantMessage",message:r,thinking:n.thinking,tools:n.data?.tools_used})}else this.postMessage({type:"error",message:"Keine Antwort vom Server."})}catch(n){this.postMessage({type:"thinking",isThinking:!1}),this.postMessage({type:"error",message:"Fehler: "+String(n)})}}async handleConnect(){this.postMessage({type:"connecting"});let e=await this.forgeClient.connect();this.updateConnectionStatus(e),e||this.postMessage({type:"error",message:"Verbindung fehlgeschlagen. L\xE4uft die Forge auf Port 8000?"})}handleDisconnect(){this.forgeClient.disconnect(),this.updateConnectionStatus(!1)}async handleAttachFile(){let e=await as.window.showOpenDialog({canSelectMany:!0,openLabel:"Anh\xE4ngen",filters:{"Alle Dateien":["*"],Code:["py","ts","js","tsx","jsx","json","html","css"],Text:["txt","md","rtf"],Dokumente:["pdf"]}});if(e&&e.length>0){for(let t of e){let n=await this.fileHandler.readFile(t.fsPath);if(n){let r=t.fsPath.split("/").pop()||t.fsPath;this.attachedFiles.push({name:r,content:n})}}this.postMessage({type:"fileAttached",files:this.attachedFiles.map(t=>t.name)})}}removeAttachment(e){this.attachedFiles.splice(e,1),this.postMessage({type:"fileAttached",files:this.attachedFiles.map(t=>t.name)})}clearChat(){this.messageHistory=[],this.attachedFiles=[],this.currentPlan=null,this.postMessage({type:"chatCleared"})}async handleCreatePlan(e){if(!this.isConnected){this.postMessage({type:"error",message:"Nicht verbunden."});return}this.postMessage({type:"thinking",isThinking:!0,message:"Erstelle Plan..."});try{let t=await this.forgeClient.createPlan(e);if(this.postMessage({type:"thinking",isThinking:!1}),t&&t.plan)this.currentPlan=t.plan,this.postMessage({type:"planCreated",plan:t.plan});else if(t&&t.content){let n=this.extractPlanFromResponse(t.content,e);this.currentPlan=n,this.postMessage({type:"planCreated",plan:n})}}catch(t){this.postMessage({type:"thinking",isThinking:!1}),this.postMessage({type:"error",message:"Plan-Erstellung fehlgeschlagen: "+String(t)})}}extractPlanFromResponse(e,t){try{let n=e.match(/\{[\s\S]*"steps"[\s\S]*\}/);if(n){let r=JSON.parse(n[0]);return{id:"plan-"+Date.now(),title:r.title||"Plan",goal:r.goal||t,steps:(r.steps||[]).map((i,o)=>({id:i.id||o+1,title:i.title||"Schritt "+(o+1),description:i.description||"",status:"pending"})),currentStepIndex:0,status:"draft"}}}catch{console.log("JSON-Parsing fehlgeschlagen, erstelle einfachen Plan")}return{id:"plan-"+Date.now(),title:"Plan f\xFCr: "+t.substring(0,50),goal:t,steps:[{id:1,title:"Aufgabe analysieren",description:t,status:"pending"}],currentStepIndex:0,status:"draft"}}async startPlanExecution(){!this.currentPlan||this.isExecuting||(this.isExecuting=!0,this.currentPlan.status="running",this.postMessage({type:"executionStarted"}),await this.executeNextStep())}async executeNextStep(){if(!this.currentPlan||!this.isExecuting)return;let e=this.currentPlan.currentStepIndex;if(e>=this.currentPlan.steps.length){this.currentPlan.status="completed",this.isExecuting=!1,this.postMessage({type:"executionCompleted",plan:this.currentPlan});return}let t=this.currentPlan.steps[e];t.status="in-progress",this.postMessage({type:"stepStarted",stepIndex:e,step:t});try{let n=this.currentPlan.steps.slice(0,e).filter(i=>i.status==="completed").map(i=>i.title+": "+(i.result||"OK")).join(`
`),r=await this.forgeClient.executeStep(this.currentPlan.id,t.id);if(r)t.status="completed",t.result=r.content||"Schritt abgeschlossen",r.files_created&&(t.files_created=r.files_created),r.files_modified&&(t.files_modified=r.files_modified),this.postMessage({type:"stepCompleted",stepIndex:e,step:t}),this.currentPlan.currentStepIndex++,await new Promise(i=>setTimeout(i,500)),await this.executeNextStep();else throw new Error("Keine Antwort vom Server")}catch(n){t.status="failed",t.error=String(n),this.currentPlan.status="failed",this.isExecuting=!1,this.postMessage({type:"stepFailed",stepIndex:e,step:t,error:String(n)})}}pausePlanExecution(){this.isExecuting=!1,this.currentPlan&&(this.currentPlan.status="paused"),this.postMessage({type:"executionPaused"})}async resumePlanExecution(){this.currentPlan&&(this.isExecuting=!0,this.currentPlan.status="running",this.postMessage({type:"executionResumed"}),await this.executeNextStep())}postMessage(e){this.view&&this.view.webview.postMessage(e)}getHtmlForWebview(e){let t=[];return t.push("<!DOCTYPE html>"),t.push('<html lang="de">'),t.push("<head>"),t.push('<meta charset="UTF-8">'),t.push('<meta name="viewport" content="width=device-width, initial-scale=1.0">'),t.push("<title>Kyberion Chat</title>"),t.push("<style>"),t.push(this.getStyles()),t.push("</style>"),t.push("</head>"),t.push("<body>"),t.push(this.getBodyHtml()),t.push("<script>"),t.push(this.getScript()),t.push("</script>"),t.push("</body>"),t.push("</html>"),t.join(`
`)}getStyles(){return["* { box-sizing: border-box; margin: 0; padding: 0; }","body { font-family: var(--vscode-font-family); background: var(--vscode-editor-background); color: var(--vscode-editor-foreground); height: 100vh; display: flex; flex-direction: column; }","/* Header */",".header { padding: 10px; border-bottom: 1px solid var(--vscode-panel-border); display: flex; align-items: center; gap: 10px; }",".status-dot { width: 10px; height: 10px; border-radius: 50%; background: #dc3545; }",".status-dot.connected { background: #28a745; }",".header-title { flex: 1; font-weight: bold; }","/* Mode Toggle */",".mode-toggle { display: flex; border-radius: 6px; overflow: hidden; border: 1px solid var(--vscode-button-border); }",".mode-btn { padding: 6px 12px; background: transparent; color: var(--vscode-button-foreground); border: none; cursor: pointer; font-size: 12px; }",".mode-btn.active { background: var(--vscode-button-background); }",".mode-btn:hover { background: var(--vscode-button-hoverBackground); }","/* Chat Container */",".chat-container { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 12px; }","/* Messages */",".message { max-width: 85%; padding: 10px 14px; border-radius: 12px; line-height: 1.5; }",".message.user { align-self: flex-end; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border-bottom-right-radius: 4px; }",".message.assistant { align-self: flex-start; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); border-bottom-left-radius: 4px; }",".message.error { background: #dc354520; border: 1px solid #dc3545; color: #dc3545; }","/* Thinking Animation */",".thinking { display: none; align-items: center; gap: 8px; padding: 10px; color: var(--vscode-descriptionForeground); }",".thinking.visible { display: flex; }",".thinking-dots { display: flex; gap: 4px; }",".thinking-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--vscode-button-background); animation: bounce 1.4s infinite ease-in-out both; }",".thinking-dot:nth-child(1) { animation-delay: -0.32s; }",".thinking-dot:nth-child(2) { animation-delay: -0.16s; }","@keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }","/* Thinking Collapsible */",".thinking-content { margin-top: 8px; padding: 8px; background: var(--vscode-textBlockQuote-background); border-radius: 6px; font-size: 12px; color: var(--vscode-descriptionForeground); }",".thinking-toggle { cursor: pointer; color: var(--vscode-textLink-foreground); font-size: 11px; margin-top: 6px; }","/* Code Blocks */","pre { background: var(--vscode-textCodeBlock-background); padding: 10px; border-radius: 6px; overflow-x: auto; margin: 8px 0; }","code { font-family: var(--vscode-editor-font-family); font-size: 13px; }","/* Plan View */",".plan-container { display: none; flex: 1; overflow-y: auto; padding: 10px; }",".plan-container.visible { display: block; }",".plan-header { font-size: 16px; font-weight: bold; margin-bottom: 10px; }",".plan-goal { color: var(--vscode-descriptionForeground); margin-bottom: 16px; font-size: 13px; }",".plan-steps { display: flex; flex-direction: column; gap: 10px; }",".plan-step { padding: 12px; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); border-radius: 8px; }",".step-header { display: flex; align-items: center; gap: 8px; }",".step-status { font-size: 16px; }",".step-title { font-weight: 500; flex: 1; }",".step-description { font-size: 12px; color: var(--vscode-descriptionForeground); margin-top: 6px; }",".step-result { font-size: 12px; margin-top: 8px; padding: 8px; background: var(--vscode-textBlockQuote-background); border-radius: 4px; }","/* Attachments */",".attachments { display: flex; flex-wrap: wrap; gap: 6px; padding: 6px 10px; border-top: 1px solid var(--vscode-panel-border); }",".attachment { display: flex; align-items: center; gap: 4px; padding: 4px 8px; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); border-radius: 4px; font-size: 11px; }",".attachment-remove { cursor: pointer; opacity: 0.7; }",".attachment-remove:hover { opacity: 1; }","/* Input Area */",".input-area { padding: 10px; border-top: 1px solid var(--vscode-panel-border); }",".input-row { display: flex; gap: 8px; align-items: flex-end; }",".input-wrapper { flex: 1; display: flex; flex-direction: column; gap: 6px; }","textarea { width: 100%; min-height: 60px; max-height: 150px; padding: 10px; background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 8px; resize: vertical; font-family: inherit; font-size: 13px; }","textarea:focus { outline: none; border-color: var(--vscode-focusBorder); }","/* Buttons */",".btn { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 6px; }",".btn-primary { background: #0078d4; color: white; }",".btn-primary:hover { background: #106ebe; }",".btn-secondary { background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }",".btn-secondary:hover { background: var(--vscode-button-secondaryHoverBackground); }",".btn-danger { background: #dc3545; color: white; }",".btn-danger:hover { background: #c82333; }",".btn-icon { padding: 8px; background: transparent; border: 1px solid var(--vscode-button-border); }",".btn-icon:hover { background: var(--vscode-button-hoverBackground); }",".btn:disabled { opacity: 0.5; cursor: not-allowed; }","/* Action Buttons (Plan Mode) */",".action-buttons { display: flex; gap: 8px; padding: 10px; border-top: 1px solid var(--vscode-panel-border); }",".action-buttons.hidden { display: none; }","/* Welcome */",".welcome { text-align: center; padding: 40px 20px; color: var(--vscode-descriptionForeground); }",".welcome-icon { font-size: 48px; margin-bottom: 16px; }",".welcome-title { font-size: 18px; font-weight: bold; color: var(--vscode-editor-foreground); margin-bottom: 8px; }",".welcome-text { font-size: 13px; line-height: 1.6; }"].join(`
`)}getBodyHtml(){return["<!-- Header -->",'<div class="header">','  <div class="status-dot" id="statusDot"></div>','  <span class="header-title">Kyberion</span>','  <div class="mode-toggle">',`    <button class="mode-btn active" id="chatModeBtn" onclick="setMode('chat')">\u{1F4AC} Chat</button>`,`    <button class="mode-btn" id="planModeBtn" onclick="setMode('plan')">\u{1F4CB} Plan</button>`,"  </div>",'  <button class="btn btn-icon" onclick="toggleConnection()" id="connectBtn" title="Verbinden">\u{1F50C}</button>',"</div>","","<!-- Chat Container -->",'<div class="chat-container" id="chatContainer">','  <div class="welcome" id="welcome">','    <div class="welcome-icon">\u{1F31F}</div>','    <div class="welcome-title">Willkommen bei Kyberion</div>','    <div class="welcome-text">',"      Ich bin dein KI-Assistent.<br>","      Verbinde dich mit dem Backend und starte eine Konversation.","    </div>","  </div>","</div>","","<!-- Plan Container -->",'<div class="plan-container" id="planContainer">','  <div class="plan-header" id="planTitle">Neuen Plan erstellen</div>','  <div class="plan-goal" id="planGoal">Beschreibe eine Aufgabe und ich erstelle einen strukturierten Plan.</div>','  <div class="plan-steps" id="planSteps"></div>',"</div>","","<!-- Thinking Indicator -->",'<div class="thinking" id="thinking">','  <div class="thinking-dots">','    <div class="thinking-dot"></div>','    <div class="thinking-dot"></div>','    <div class="thinking-dot"></div>',"  </div>",'  <span id="thinkingText">Kyberion denkt...</span>',"</div>","","<!-- Attachments -->",'<div class="attachments" id="attachments" style="display: none;"></div>',"","<!-- Action Buttons (Plan Mode) -->",'<div class="action-buttons hidden" id="actionButtons">','  <button class="btn btn-primary" id="actBtn" onclick="startExecution()">\u25B6\uFE0F ACT Starten</button>','  <button class="btn btn-secondary" id="pauseBtn" onclick="pauseExecution()" style="display: none;">\u23F8\uFE0F Pause</button>','  <button class="btn btn-secondary" id="resumeBtn" onclick="resumeExecution()" style="display: none;">\u25B6\uFE0F Fortsetzen</button>','  <button class="btn btn-secondary" onclick="recreatePlan()">\u{1F504} Neu</button>',"</div>","","<!-- Input Area -->",'<div class="input-area">','  <div class="input-row">','    <button class="btn btn-icon" onclick="attachFile()" title="Datei anh\xE4ngen">\u{1F4CE}</button>','    <div class="input-wrapper">','      <textarea id="messageInput" placeholder="Nachricht eingeben..." onkeydown="handleKeyDown(event)"></textarea>',"    </div>",'    <button class="btn btn-primary" onclick="sendMessage()" id="sendBtn">\u27A4</button>',"  </div>","</div>"].join(`
`)}getScript(){return["const vscode = acquireVsCodeApi();","let isConnected = false;","let isPlanMode = false;","let currentPlan = null;","","// Elemente",'const chatContainer = document.getElementById("chatContainer");','const planContainer = document.getElementById("planContainer");','const welcome = document.getElementById("welcome");','const thinking = document.getElementById("thinking");','const thinkingText = document.getElementById("thinkingText");','const statusDot = document.getElementById("statusDot");','const messageInput = document.getElementById("messageInput");','const attachmentsDiv = document.getElementById("attachments");','const actionButtons = document.getElementById("actionButtons");','const planSteps = document.getElementById("planSteps");','const planTitle = document.getElementById("planTitle");','const planGoal = document.getElementById("planGoal");',"","// Modus wechseln","function setMode(mode) {",'  isPlanMode = mode === "plan";','  document.getElementById("chatModeBtn").classList.toggle("active", !isPlanMode);','  document.getElementById("planModeBtn").classList.toggle("active", isPlanMode);','  chatContainer.style.display = isPlanMode ? "none" : "flex";','  planContainer.classList.toggle("visible", isPlanMode);','  actionButtons.classList.toggle("hidden", !isPlanMode || !currentPlan);','  messageInput.placeholder = isPlanMode ? "Beschreibe die Aufgabe..." : "Nachricht eingeben...";',"}","","// Verbindung","function toggleConnection() {","  if (isConnected) {",'    vscode.postMessage({ type: "disconnect" });',"  } else {",'    vscode.postMessage({ type: "connect" });',"  }","}","","// Nachricht senden","function sendMessage() {","  const message = messageInput.value.trim();","  if (!message) return;","  ","  if (isPlanMode && !currentPlan) {",'    vscode.postMessage({ type: "createPlan", message: message });',"  } else {",'    vscode.postMessage({ type: "sendMessage", message: message });',"  }",'  messageInput.value = "";',"}","","// Tastatur-Handler","function handleKeyDown(event) {",'  if (event.key === "Enter" && !event.shiftKey) {',"    event.preventDefault();","    sendMessage();","  }","}","","// Datei anh\xE4ngen","function attachFile() {",'  vscode.postMessage({ type: "attachFile" });',"}","","// Plan-Ausf\xFChrung","function startExecution() {",'  vscode.postMessage({ type: "startExecution" });',"}","","function pauseExecution() {",'  vscode.postMessage({ type: "pauseExecution" });',"}","","function resumeExecution() {",'  vscode.postMessage({ type: "resumeExecution" });',"}","","function recreatePlan() {","  currentPlan = null;",'  planSteps.innerHTML = "";','  planTitle.textContent = "Neuen Plan erstellen";','  planGoal.textContent = "Beschreibe eine Aufgabe und ich erstelle einen strukturierten Plan.";','  actionButtons.classList.add("hidden");',"}","","// Nachricht hinzuf\xFCgen","function addMessage(content, type, extra) {",'  welcome.style.display = "none";',"  ",'  const msg = document.createElement("div");','  msg.className = "message " + type;',"  ","  // Markdown-\xE4hnliches Rendering","  let html = content;","  // Code-Bl\xF6cke","  html = html.replace(/```(\\w*)\\n([\\s\\S]*?)```/g, function(match, lang, code) {",'    return "<pre><code class=\\"language-" + lang + "\\">" + escapeHtml(code) + "</code></pre>";',"  });","  // Inline-Code",'  html = html.replace(/`([^`]+)`/g, "<code>$1</code>");',"  // Bold",'  html = html.replace(/\\*\\*([^*]+)\\*\\*/g, "<strong>$1</strong>");',"  // Newlines",'  html = html.replace(/\\n/g, "<br>");',"  ","  msg.innerHTML = html;","  ","  // Thinking anzeigen (collapsible)","  if (extra && extra.thinking) {",'    const thinkingDiv = document.createElement("div");','    thinkingDiv.className = "thinking-content";','    thinkingDiv.style.display = "none";',"    thinkingDiv.textContent = extra.thinking;","    ",'    const toggle = document.createElement("div");','    toggle.className = "thinking-toggle";','    toggle.textContent = "\u{1F4AD} Gedanken anzeigen";',"    toggle.onclick = function() {",'      const visible = thinkingDiv.style.display !== "none";','      thinkingDiv.style.display = visible ? "none" : "block";','      toggle.textContent = visible ? "\u{1F4AD} Gedanken anzeigen" : "\u{1F4AD} Gedanken verbergen";',"    };","    ","    msg.appendChild(toggle);","    msg.appendChild(thinkingDiv);","  }","  ","  chatContainer.appendChild(msg);","  chatContainer.scrollTop = chatContainer.scrollHeight;","}","","function escapeHtml(text) {",'  const div = document.createElement("div");',"  div.textContent = text;","  return div.innerHTML;","}","","// Status-Icon f\xFCr Plan-Schritt","function getStepStatusIcon(status) {","  switch(status) {",'    case "pending": return "\u23F3";','    case "in-progress": return "\u{1F504}";','    case "completed": return "\u2705";','    case "failed": return "\u274C";','    default: return "\u23F3";',"  }","}","","// Plan-Schritt rendern","function renderPlanStep(step) {",'  const div = document.createElement("div");','  div.className = "plan-step";','  div.id = "step-" + step.id;',"  ",'  let html = "<div class=\\"step-header\\">";','  html += "<span class=\\"step-status\\">" + getStepStatusIcon(step.status) + "</span>";','  html += "<span class=\\"step-title\\">Schritt " + step.id + ": " + escapeHtml(step.title) + "</span>";','  html += "</div>";',"  if (step.description) {",'    html += "<div class=\\"step-description\\">" + escapeHtml(step.description) + "</div>";',"  }","  if (step.result) {",'    html += "<div class=\\"step-result\\">\u2713 " + escapeHtml(step.result.substring(0, 200)) + "</div>";',"  }","  if (step.error) {",'    html += "<div class=\\"step-result\\" style=\\"color: #dc3545;\\">\u2717 " + escapeHtml(step.error) + "</div>";',"  }","  ","  div.innerHTML = html;","  return div;","}","","// Plan rendern","function renderPlan(plan) {","  currentPlan = plan;",'  planTitle.textContent = "\u{1F4CB} " + plan.title;',"  planGoal.textContent = plan.goal;",'  planSteps.innerHTML = "";',"  ","  for (const step of plan.steps) {","    planSteps.appendChild(renderPlanStep(step));","  }","  ",'  actionButtons.classList.remove("hidden");',"}","","// Schritt aktualisieren","function updateStep(stepIndex, step) {",'  const existing = document.getElementById("step-" + step.id);',"  if (existing) {","    existing.replaceWith(renderPlanStep(step));","  }","}","","// Nachrichten von Extension empfangen",'window.addEventListener("message", function(event) {',"  const data = event.data;","  ","  switch(data.type) {",'    case "connectionStatus":',"      isConnected = data.connected;",'      statusDot.classList.toggle("connected", isConnected);','      document.getElementById("connectBtn").title = isConnected ? "Trennen" : "Verbinden";',"      break;","    ",'    case "connecting":','      thinkingText.textContent = "Verbinde...";','      thinking.classList.add("visible");',"      break;","    ",'    case "thinking":',"      if (data.isThinking) {",'        thinkingText.textContent = data.message || "Kyberion denkt...";','        thinking.classList.add("visible");',"      } else {",'        thinking.classList.remove("visible");',"      }","      break;","    ",'    case "userMessage":','      addMessage(data.message, "user");',"      break;","    ",'    case "assistantMessage":','      addMessage(data.message, "assistant", { thinking: data.thinking, tools: data.tools });',"      break;","    ",'    case "error":','      addMessage(data.message, "error");',"      break;","    ",'    case "fileAttached":',"      if (data.files && data.files.length > 0) {",'        attachmentsDiv.style.display = "flex";',"        attachmentsDiv.innerHTML = data.files.map(function(f, i) {",'          return "<div class=\\"attachment\\">\u{1F4C4} " + escapeHtml(f) + " <span class=\\"attachment-remove\\" onclick=\\"removeAttachment(" + i + ")\\">\xD7</span></div>";','        }).join("");',"      } else {",'        attachmentsDiv.style.display = "none";','        attachmentsDiv.innerHTML = "";',"      }","      break;","    ",'    case "modeChanged":','      setMode(data.isPlanMode ? "plan" : "chat");',"      break;","    ",'    case "planCreated":',"      renderPlan(data.plan);",'      thinking.classList.remove("visible");',"      break;","    ",'    case "executionStarted":','      document.getElementById("actBtn").style.display = "none";','      document.getElementById("pauseBtn").style.display = "flex";','      document.getElementById("resumeBtn").style.display = "none";',"      break;","    ",'    case "stepStarted":','    case "stepCompleted":','    case "stepFailed":',"      updateStep(data.stepIndex, data.step);","      break;","    ",'    case "executionPaused":','      document.getElementById("actBtn").style.display = "none";','      document.getElementById("pauseBtn").style.display = "none";','      document.getElementById("resumeBtn").style.display = "flex";',"      break;","    ",'    case "executionResumed":','      document.getElementById("actBtn").style.display = "none";','      document.getElementById("pauseBtn").style.display = "flex";','      document.getElementById("resumeBtn").style.display = "none";',"      break;","    ",'    case "executionCompleted":','      document.getElementById("actBtn").style.display = "none";','      document.getElementById("pauseBtn").style.display = "none";','      document.getElementById("resumeBtn").style.display = "none";','      addMessage("\u2705 Plan erfolgreich abgeschlossen!", "assistant");',"      break;","    ",'    case "chatCleared":','      chatContainer.innerHTML = "";','      welcome.style.display = "block";',"      chatContainer.appendChild(welcome);","      recreatePlan();","      break;","  }","});","","function removeAttachment(index) {",'  vscode.postMessage({ type: "removeAttachment", index: index });',"}"].join(`
`)}};var ls=C(require("vscode")),M=C(require("fs")),N=C(require("path")),Ee=class{constructor(){let e=ls.workspace.getConfiguration("kyberion");this.devDirectory=e.get("devDirectory")||"/Users/gregorklauss/dev"}async readFile(e){try{return this.isAllowedPath(e)?await M.promises.readFile(e,"utf-8"):(console.warn("Zugriff verweigert:",e),null)}catch(t){return console.error("Fehler beim Lesen:",t),null}}async writeFile(e,t){try{if(!this.isAllowedPath(e))return console.warn("Schreibzugriff verweigert:",e),!1;let n=N.dirname(e);return await M.promises.mkdir(n,{recursive:!0}),await M.promises.writeFile(e,t,"utf-8"),!0}catch(n){return console.error("Fehler beim Schreiben:",n),!1}}async createFile(e,t=""){return this.writeFile(e,t)}async deleteFile(e){try{return this.isAllowedPath(e)?(await M.promises.unlink(e),!0):(console.warn("L\xF6schzugriff verweigert:",e),!1)}catch(t){return console.error("Fehler beim L\xF6schen:",t),!1}}async createDirectory(e){try{return this.isAllowedPath(e)?(await M.promises.mkdir(e,{recursive:!0}),!0):(console.warn("Ordner-Erstellung verweigert:",e),!1)}catch(t){return console.error("Fehler beim Ordner erstellen:",t),!1}}async listDirectory(e){try{return this.isAllowedPath(e)?(await M.promises.readdir(e,{withFileTypes:!0})).map(n=>n.isDirectory()?n.name+"/":n.name):(console.warn("Ordner-Zugriff verweigert:",e),null)}catch(t){return console.error("Fehler beim Auflisten:",t),null}}async exists(e){try{return await M.promises.access(e),!0}catch{return!1}}async rename(e,t){try{return!this.isAllowedPath(e)||!this.isAllowedPath(t)?(console.warn("Umbenennen verweigert:",e,"->",t),!1):(await M.promises.rename(e,t),!0)}catch(n){return console.error("Fehler beim Umbenennen:",n),!1}}async getFileInfo(e){try{let t=await M.promises.stat(e);return{path:e,name:N.basename(e),extension:N.extname(e),size:t.size,isDirectory:t.isDirectory(),modifiedAt:t.mtime,createdAt:t.birthtime}}catch(t){return console.error("Fehler beim Info-Abruf:",t),null}}isAllowedPath(e){return N.normalize(e).startsWith(this.devDirectory)}getLanguageForFile(e){let t=N.extname(e).toLowerCase();return{".py":"python",".ts":"typescript",".js":"javascript",".tsx":"typescriptreact",".jsx":"javascriptreact",".json":"json",".md":"markdown",".html":"html",".css":"css",".scss":"scss",".yaml":"yaml",".yml":"yaml",".xml":"xml",".sql":"sql",".sh":"shellscript",".bash":"shellscript",".zsh":"shellscript",".txt":"plaintext",".rtf":"plaintext",".pdf":"pdf"}[t]||"plaintext"}};var k,Z,Qe,T;function qn(s){console.log("Kyberion Forge Extension wird aktiviert...");let e=f.workspace.getConfiguration("kyberion"),t=e.get("forgeWsUrl")||"ws://localhost:8000/ws/nexus",n=e.get("autoConnect")??!0;k=os(t),Qe=new Ee,Z=new we(s.extensionUri,k,Qe),s.subscriptions.push(f.window.registerWebviewViewProvider("kyberion.chatView",Z,{webviewOptions:{retainContextWhenHidden:!0}})),T=f.window.createStatusBarItem(f.StatusBarAlignment.Right,100),T.command="kyberion.showStatus",cs(!1),T.show(),s.subscriptions.push(T),Hn(s),k.onConnectionChange(r=>{cs(r),Z.updateConnectionStatus(r)}),k.onMessage(r=>{(r.type==="thought"||r.type==="agent_activity")&&Z.handleForgeMessage(r)}),n&&k.connect().then(r=>{r&&f.window.showInformationMessage("Kyberion Forge verbunden!")}),console.log("Kyberion Forge Extension aktiviert!")}function Hn(s){s.subscriptions.push(f.commands.registerCommand("kyberion.openChat",()=>{f.commands.executeCommand("kyberion.chatView.focus")})),s.subscriptions.push(f.commands.registerCommand("kyberion.connect",async()=>{await k.connect()?f.window.showInformationMessage("Kyberion Forge verbunden!"):f.window.showErrorMessage("Verbindung fehlgeschlagen")})),s.subscriptions.push(f.commands.registerCommand("kyberion.disconnect",()=>{k.disconnect(),f.window.showInformationMessage("Forge getrennt.")})),s.subscriptions.push(f.commands.registerCommand("kyberion.analyzeFile",async e=>{let t=e;if(!t&&f.window.activeTextEditor&&(t=f.window.activeTextEditor.document.uri),t){let n=await Qe.readFile(t.fsPath);n&&(Z.analyzeFile(t.fsPath,n),f.commands.executeCommand("kyberion.chatView.focus"))}})),s.subscriptions.push(f.commands.registerCommand("kyberion.showStatus",async()=>{if(!k.isConnected()){f.window.showWarningMessage("Forge nicht verbunden");return}try{let e=await k.getStatus();f.window.showInformationMessage("Forge Status OK")}catch{f.window.showErrorMessage("Status Fehler")}})),s.subscriptions.push(f.commands.registerCommand("kyberion.togglePlanMode",()=>{Z.togglePlanMode()}))}function cs(s){s?(T.text="$(flame) Forge",T.tooltip="Kyberion Forge verbunden",T.backgroundColor=void 0):(T.text="$(debug-disconnect) Forge",T.tooltip="Forge getrennt",T.backgroundColor=new f.ThemeColor("statusBarItem.errorBackground"))}function jn(){k&&k.disconnect()}0&&(module.exports={activate,deactivate});
